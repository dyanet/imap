"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.GmailViewerCdkStack = void 0;
const cdk = __importStar(require("aws-cdk-lib"));
const apigatewayv2 = __importStar(require("aws-cdk-lib/aws-apigatewayv2"));
const codebuild = __importStar(require("aws-cdk-lib/aws-codebuild"));
const cr = __importStar(require("aws-cdk-lib/custom-resources"));
const ec2 = __importStar(require("aws-cdk-lib/aws-ec2"));
const ecr = __importStar(require("aws-cdk-lib/aws-ecr"));
const ecs = __importStar(require("aws-cdk-lib/aws-ecs"));
const iam = __importStar(require("aws-cdk-lib/aws-iam"));
const logs = __importStar(require("aws-cdk-lib/aws-logs"));
const route53 = __importStar(require("aws-cdk-lib/aws-route53"));
const servicediscovery = __importStar(require("aws-cdk-lib/aws-servicediscovery"));
const secretsmanager = __importStar(require("aws-cdk-lib/aws-secretsmanager"));
class GmailViewerCdkStack extends cdk.Stack {
    clusterName;
    repositoryUri;
    apiInvokeUrl;
    cloudMapServiceArn;
    constructor(scope, id, props) {
        super(scope, id, props);
        const toNumber = (value, fallback) => {
            const candidate = value ?? fallback;
            const parsed = typeof candidate === 'number' ? candidate : Number(candidate);
            return Number.isFinite(parsed) ? parsed : fallback;
        };
        const toCpuUnits = (value) => {
            const parsed = toNumber(value, 0.5);
            const vcpu = parsed <= 4 ? parsed * 1024 : parsed;
            return Math.max(256, Math.round(vcpu / 256) * 256);
        };
        const repoParts = (process.env.GITHUB_REPOSITORY ?? '').split('/');
        const containerPort = toNumber(props.containerPort, 3000);
        const containerCpu = toCpuUnits(props.containerCpu);
        const containerMemory = toNumber(props.containerMemory, 1024);
        const desiredCount = toNumber(props.desiredCount, 1);
        const nsName = props.serviceDiscoveryNamespaceName ?? 'mail.local';
        const nsTtl = cdk.Duration.seconds(toNumber(props.serviceDiscoveryTtl, 60));
        const ssmPrefixRaw = props.ssmPrefix ?? '/mail-example';
        const ssmPrefix = '/' + ssmPrefixRaw.split('/').filter(p => p).join('/');
        const gitHubOwner = props.gitHubOwner ?? (repoParts[0] || 'dyanet');
        const gitHubRepo = props.gitHubRepo ?? (repoParts[1] || 'imap');
        const gitHubBranch = props.gitHubBranch ?? process.env.GITHUB_REF_NAME ?? 'main';
        const publicEnvValue = props.publicEnvValue ?? 'production';
        const googleClientId = props.googleClientId || 'PLACEHOLDER_GOOGLE_CLIENT_ID';
        const googleClientSecret = props.googleClientSecret || 'PLACEHOLDER_GOOGLE_CLIENT_SECRET';
        const sessionSecretValue = props.sessionSecretValue || 'PLACEHOLDER_SESSION_SECRET';
        const apiDomain = props.apiCustomDomainName ?? process.env.API_CUSTOM_DOMAIN ?? 'demo.dyanet.com';
        const certArn = props.certificateArn ?? this.node.tryGetContext('certificateArn') ?? process.env.CERTIFICATE_ARN;
        const zoneId = props.hostedZoneId ?? '';
        const hasCustomDomain = Boolean(certArn && apiDomain);
        const hasHostedZone = Boolean(zoneId);
        const usePublicSubnets = props.publicSubnets && props.publicSubnets.length > 0;
        // VPC setup
        let vpc;
        let serviceSubnetIds;
        const useVpcParameter = this.node.tryGetContext('useVpcParameter');
        if (!useVpcParameter && this.account && this.region) {
            vpc = ec2.Vpc.fromLookup(this, 'MailVpc', { tags: { Name: 'dya-vpc' } });
            if (usePublicSubnets) {
                serviceSubnetIds = props.publicSubnets;
            }
            else if (props.privateSubnets && props.privateSubnets.length > 0) {
                serviceSubnetIds = props.privateSubnets;
            }
            else {
                const badAz = 'cac1-az4';
                let subnets = vpc.privateSubnets.filter(s => s.availabilityZone !== badAz);
                if (subnets.length === 0)
                    subnets = vpc.publicSubnets.filter(s => s.availabilityZone !== badAz);
                serviceSubnetIds = subnets.slice(0, 2).map(s => s.subnetId);
                if (serviceSubnetIds.length < 1)
                    throw new Error(`VPC must have at least one subnet in an allowed AZ.`);
            }
        }
        else {
            const vpcIdParam = new cdk.CfnParameter(this, 'VpcIdParam', { type: 'AWS::EC2::VPC::Id', default: props.vpcId ?? '' });
            const subnetParam = new cdk.CfnParameter(this, 'PrivateSubnetIdsParam', { type: 'CommaDelimitedList', default: props.privateSubnets?.join(',') ?? '' });
            vpc = ec2.Vpc.fromVpcAttributes(this, 'MailVpc', { vpcId: vpcIdParam.valueAsString, availabilityZones: cdk.Fn.getAzs(), privateSubnetIds: subnetParam.valueAsList });
            serviceSubnetIds = props.privateSubnets ?? subnetParam.valueAsList;
        }
        // Security Groups (L2)
        const apiVpcLinkSg = new ec2.SecurityGroup(this, 'ApiVpcLinkSecurityGroup', { vpc, description: 'Egress from API Gateway VPC Link', allowAllOutbound: false });
        apiVpcLinkSg.addEgressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(containerPort));
        const serviceSg = new ec2.SecurityGroup(this, 'ServiceSecurityGroup', { vpc, description: 'Allow traffic to Fargate tasks', allowAllOutbound: true });
        serviceSg.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(containerPort));
        // Log Group (L2)
        const appLogGroup = new logs.LogGroup(this, 'AppLogGroup', { logGroupName: '/ecs/mail-example', retention: logs.RetentionDays.ONE_MONTH, removalPolicy: cdk.RemovalPolicy.DESTROY });
        // ECS Cluster (L2)
        const cluster = new ecs.Cluster(this, 'MailCluster', { vpc, clusterName: 'public-cluster', enableFargateCapacityProviders: true });
        // ECR Repository - create if not exists using custom resource
        const ecrRepoName = 'mail-example';
        const checkEcrRepo = new cr.AwsCustomResource(this, 'CheckEcrRepo', {
            onCreate: { service: 'ECR', action: 'describeRepositories', parameters: { repositoryNames: [ecrRepoName] }, physicalResourceId: cr.PhysicalResourceId.of(ecrRepoName) },
            policy: cr.AwsCustomResourcePolicy.fromSdkCalls({ resources: cr.AwsCustomResourcePolicy.ANY_RESOURCE }),
        });
        const createEcrRepo = new cr.AwsCustomResource(this, 'CreateEcrRepo', {
            onCreate: { service: 'ECR', action: 'createRepository', parameters: { repositoryName: ecrRepoName, imageTagMutability: 'MUTABLE', encryptionConfiguration: { encryptionType: 'AES256' } }, physicalResourceId: cr.PhysicalResourceId.of(ecrRepoName), ignoreErrorCodesMatching: 'RepositoryAlreadyExistsException' },
            policy: cr.AwsCustomResourcePolicy.fromSdkCalls({ resources: cr.AwsCustomResourcePolicy.ANY_RESOURCE }),
        });
        createEcrRepo.node.addDependency(checkEcrRepo);
        const ecrRepo = ecr.Repository.fromRepositoryName(this, 'MailExampleRepositoryRef', ecrRepoName);
        // API Gateway HTTP API (L1 - no L2 for HTTP API with VPC Link)
        const httpApi = new apigatewayv2.CfnApi(this, 'MailHttpApi', { name: 'mail-example', protocolType: 'HTTP' });
        const apiStage = new apigatewayv2.CfnStage(this, 'MailApiStage', { stageName: 'prod', apiId: httpApi.ref, autoDeploy: true });
        const apiDomainName = hasCustomDomain ? new apigatewayv2.CfnDomainName(this, 'ApiDomainName', {
            domainName: apiDomain, domainNameConfigurations: [{ certificateArn: certArn, endpointType: 'REGIONAL', securityPolicy: 'TLS_1_2' }],
        }) : undefined;
        const apiMapping = hasCustomDomain && apiDomainName ? new apigatewayv2.CfnApiMapping(this, 'ApiMapping', {
            apiId: httpApi.ref, domainName: apiDomainName.ref, stage: apiStage.ref, apiMappingKey: 'examples',
        }) : undefined;
        if (apiMapping && apiDomainName) {
            apiMapping.addDependency(apiDomainName);
            apiMapping.addDependency(apiStage);
        }
        const apiRecord = hasCustomDomain && hasHostedZone && apiDomainName ? new route53.CfnRecordSet(this, 'ApiDomainRecord', {
            hostedZoneId: zoneId, name: apiDomain, type: 'A', aliasTarget: { dnsName: apiDomainName.attrRegionalDomainName, hostedZoneId: apiDomainName.attrRegionalHostedZoneId },
        }) : undefined;
        if (apiRecord && apiDomainName)
            apiRecord.addDependency(apiDomainName);
        const baseUrl = hasCustomDomain ? `https://${apiDomain}/examples/gmail-viewer` : cdk.Fn.join('', [httpApi.attrApiEndpoint, '/', apiStage.ref, '/gmail-viewer']);
        // Cloud Map Namespace (L2)
        const namespace = new servicediscovery.PrivateDnsNamespace(this, 'ServiceNamespace', { name: nsName, vpc, description: 'Namespace for mail services' });
        // VPC Link (L1)
        const vpcLink = new apigatewayv2.CfnVpcLink(this, 'ApiVpcLink', { name: 'mail-example-vpclink', subnetIds: serviceSubnetIds, securityGroupIds: [apiVpcLinkSg.securityGroupId] });
        // Cloud Map Service (L2)
        const cloudMapService = new servicediscovery.Service(this, 'AppCloudMapService', {
            name: 'mail-example', namespace, dnsRecordType: servicediscovery.DnsRecordType.SRV, dnsTtl: nsTtl, routingPolicy: servicediscovery.RoutingPolicy.WEIGHTED, customHealthCheck: { failureThreshold: 1 },
        });
        // Secrets Manager - all config values for the application
        const appSecrets = new secretsmanager.Secret(this, 'AppSecrets', {
            secretName: `${ssmPrefix}/config`,
            description: 'Application configuration for mail-example',
            secretObjectValue: {
                GOOGLE_CLIENT_ID: cdk.SecretValue.unsafePlainText(googleClientId),
                GOOGLE_CLIENT_SECRET: cdk.SecretValue.unsafePlainText(googleClientSecret),
                SESSION_SECRET: cdk.SecretValue.unsafePlainText(sessionSecretValue),
                BASE_URL: cdk.SecretValue.unsafePlainText(baseUrl.toString()),
                PORT: cdk.SecretValue.unsafePlainText(containerPort.toString()),
            },
        });
        // IAM Roles (L2)
        const taskExecRole = new iam.Role(this, 'TaskExecutionRole', { assumedBy: new iam.ServicePrincipal('ecs-tasks.amazonaws.com'), managedPolicies: [iam.ManagedPolicy.fromAwsManagedPolicyName('service-role/AmazonECSTaskExecutionRolePolicy')] });
        taskExecRole.addToPolicy(new iam.PolicyStatement({ actions: ['ssm:GetParameter', 'ssm:GetParameters', 'ssm:GetParametersByPath', 'kms:Decrypt'], resources: [`arn:aws:ssm:${this.region}:${this.account}:parameter${ssmPrefix}*`, `arn:aws:kms:${this.region}:${this.account}:key/*`] }));
        taskExecRole.addToPolicy(new iam.PolicyStatement({ actions: ['secretsmanager:GetSecretValue'], resources: [appSecrets.secretArn] }));
        const taskRole = new iam.Role(this, 'TaskRole', { assumedBy: new iam.ServicePrincipal('ecs-tasks.amazonaws.com') });
        taskRole.addToPolicy(new iam.PolicyStatement({ actions: ['ssm:GetParameter', 'ssm:GetParameters', 'ssm:GetParametersByPath', 'kms:Decrypt'], resources: [`arn:aws:ssm:${this.region}:${this.account}:parameter${ssmPrefix}*`, `arn:aws:kms:${this.region}:${this.account}:key/*`] }));
        taskRole.addToPolicy(new iam.PolicyStatement({ actions: ['secretsmanager:GetSecretValue'], resources: [appSecrets.secretArn] }));
        // ECS Task Definition (L2)
        const taskDef = new ecs.FargateTaskDefinition(this, 'AppTaskDefinition', { family: 'mail-example', cpu: containerCpu, memoryLimitMiB: containerMemory, executionRole: taskExecRole, taskRole });
        taskDef.addContainer('mail-example', {
            image: ecs.ContainerImage.fromEcrRepository(ecrRepo, 'latest'), portMappings: [{ containerPort }],
            logging: ecs.LogDrivers.awsLogs({ logGroup: appLogGroup, streamPrefix: 'mail-example' }),
            environment: { CONFIG_SSM_PREFIX: ssmPrefix, PORT: containerPort.toString(), BASE_URL: baseUrl.toString(), NODE_ENV: publicEnvValue },
            secrets: {
                GOOGLE_CLIENT_ID: ecs.Secret.fromSecretsManager(appSecrets, 'GOOGLE_CLIENT_ID'),
                GOOGLE_CLIENT_SECRET: ecs.Secret.fromSecretsManager(appSecrets, 'GOOGLE_CLIENT_SECRET'),
                SESSION_SECRET: ecs.Secret.fromSecretsManager(appSecrets, 'SESSION_SECRET'),
            },
        });
        // ECS Service (L2) - associate with standalone Cloud Map service for API Gateway integration
        const service = new ecs.FargateService(this, 'AppService', {
            serviceName: 'mail-example', cluster, taskDefinition: taskDef, desiredCount,
            capacityProviderStrategies: [{ capacityProvider: 'FARGATE_SPOT', weight: 4 }, { capacityProvider: 'FARGATE', weight: 1 }],
            vpcSubnets: { subnets: serviceSubnetIds.map((id, i) => ec2.Subnet.fromSubnetId(this, `ServiceSubnet${i}`, id)) },
            securityGroups: [serviceSg], assignPublicIp: usePublicSubnets ?? false, minHealthyPercent: 50, maxHealthyPercent: 200,
        });
        service.associateCloudMapService({ service: cloudMapService, containerPort, container: taskDef.defaultContainer });
        // API Gateway Integration (L1)
        const integration = new apigatewayv2.CfnIntegration(this, 'MailIntegration', { apiId: httpApi.ref, integrationType: 'HTTP_PROXY', integrationMethod: 'ANY', integrationUri: cloudMapService.serviceArn, connectionType: 'VPC_LINK', connectionId: vpcLink.ref, payloadFormatVersion: '1.0' });
        new apigatewayv2.CfnRoute(this, 'GmailViewerRoute', { apiId: httpApi.ref, routeKey: 'ANY /gmail-viewer', target: `integrations/${integration.ref}` });
        new apigatewayv2.CfnRoute(this, 'GmailViewerProxyRoute', { apiId: httpApi.ref, routeKey: 'ANY /gmail-viewer/{proxy+}', target: `integrations/${integration.ref}` });
        // CodeBuild Role (L2)
        const buildRole = new iam.Role(this, 'CodeBuildRole', { assumedBy: new iam.ServicePrincipal('codebuild.amazonaws.com') });
        buildRole.addToPolicy(new iam.PolicyStatement({ actions: ['logs:CreateLogGroup', 'logs:CreateLogStream', 'logs:PutLogEvents'], resources: ['*'] }));
        buildRole.addToPolicy(new iam.PolicyStatement({ actions: ['ecr:GetAuthorizationToken', 'ecr:BatchCheckLayerAvailability', 'ecr:CompleteLayerUpload', 'ecr:BatchGetImage', 'ecr:DescribeRepositories', 'ecr:InitiateLayerUpload', 'ecr:PutImage', 'ecr:UploadLayerPart'], resources: ['*'] }));
        buildRole.addToPolicy(new iam.PolicyStatement({ actions: ['ecs:UpdateService', 'ecs:DescribeServices', 'ecs:DescribeClusters'], resources: ['*'] }));
        buildRole.addToPolicy(new iam.PolicyStatement({ actions: ['ssm:GetParameter', 'ssm:GetParameters', 'ssm:GetParametersByPath'], resources: ['*'] }));
        if (props.codeConnectionArn)
            buildRole.addToPolicy(new iam.PolicyStatement({ actions: ['codeconnections:GetConnection', 'codeconnections:GetConnectionToken', 'codeconnections:UseConnection'], resources: [props.codeConnectionArn] }));
        // CodeBuild Project (L2)
        new codebuild.Project(this, 'CodeBuildProject', {
            projectName: 'mail-example', role: buildRole,
            environment: { buildImage: codebuild.LinuxBuildImage.STANDARD_7_0, computeType: codebuild.ComputeType.SMALL, privileged: true, environmentVariables: { ECR_URI: { value: ecrRepo.repositoryUri }, CLUSTER_NAME: { value: cluster.clusterName }, SERVICE_NAME: { value: 'mail-example' } } },
            source: codebuild.Source.gitHub({ owner: gitHubOwner, repo: gitHubRepo, branchOrRef: gitHubBranch }),
            timeout: cdk.Duration.minutes(30), queuedTimeout: cdk.Duration.minutes(30), badge: true, description: 'Build & deploy mail-example to ECR then force ECS deploy',
            buildSpec: codebuild.BuildSpec.fromObject({
                version: '0.2',
                phases: {
                    pre_build: { commands: ['echo "Logging in to ECR"', 'aws ecr get-login-password --region $AWS_DEFAULT_REGION | docker login --username AWS --password-stdin $ECR_URI', 'IMAGE_TAG=${CODEBUILD_RESOLVED_SOURCE_VERSION:-latest}'] },
                    build: { commands: ['cd examples/gmail-viewer', 'docker build -t $ECR_URI:latest -t $ECR_URI:$IMAGE_TAG .'] },
                    post_build: { commands: ['docker push $ECR_URI:latest', 'docker push $ECR_URI:$IMAGE_TAG', 'aws ecs update-service --cluster $CLUSTER_NAME --service $SERVICE_NAME --force-new-deployment'] },
                },
                artifacts: { files: [] }, env: { shell: 'bash' },
            }),
        });
        // Outputs
        this.clusterName = cluster.clusterName;
        new cdk.CfnOutput(this, 'ClusterName', { value: this.clusterName });
        this.repositoryUri = ecrRepo.repositoryUri;
        new cdk.CfnOutput(this, 'RepositoryUri', { value: this.repositoryUri });
        this.apiInvokeUrl = baseUrl.toString();
        new cdk.CfnOutput(this, 'ApiInvokeUrl', { value: this.apiInvokeUrl });
        this.cloudMapServiceArn = cloudMapService.serviceArn;
        new cdk.CfnOutput(this, 'CloudMapServiceArn', { value: this.cloudMapServiceArn });
    }
}
exports.GmailViewerCdkStack = GmailViewerCdkStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ21haWwtdmlld2VyLWNkay1zdGFjay5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImdtYWlsLXZpZXdlci1jZGstc3RhY2sudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsaURBQW1DO0FBQ25DLDJFQUE2RDtBQUM3RCxxRUFBdUQ7QUFDdkQsaUVBQW1EO0FBQ25ELHlEQUEyQztBQUMzQyx5REFBMkM7QUFDM0MseURBQTJDO0FBQzNDLHlEQUEyQztBQUMzQywyREFBNkM7QUFDN0MsaUVBQW1EO0FBQ25ELG1GQUFxRTtBQUNyRSwrRUFBaUU7QUE0QmpFLE1BQWEsbUJBQW9CLFNBQVEsR0FBRyxDQUFDLEtBQUs7SUFDaEMsV0FBVyxDQUFTO0lBQ3BCLGFBQWEsQ0FBUztJQUN0QixZQUFZLENBQVM7SUFDckIsa0JBQWtCLENBQVM7SUFFM0MsWUFBbUIsS0FBYyxFQUFFLEVBQVUsRUFBRSxLQUErQjtRQUM1RSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUV4QixNQUFNLFFBQVEsR0FBRyxDQUFDLEtBQWtDLEVBQUUsUUFBZ0IsRUFBVSxFQUFFO1lBQ2hGLE1BQU0sU0FBUyxHQUFHLEtBQUssSUFBSSxRQUFRLENBQUM7WUFDcEMsTUFBTSxNQUFNLEdBQUcsT0FBTyxTQUFTLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUM3RSxPQUFPLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO1FBQ3JELENBQUMsQ0FBQztRQUNGLE1BQU0sVUFBVSxHQUFHLENBQUMsS0FBa0MsRUFBVSxFQUFFO1lBQ2hFLE1BQU0sTUFBTSxHQUFHLFFBQVEsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDcEMsTUFBTSxJQUFJLEdBQUcsTUFBTSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO1lBQ2xELE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDckQsQ0FBQyxDQUFDO1FBRUYsTUFBTSxTQUFTLEdBQUcsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFpQixJQUFJLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNuRSxNQUFNLGFBQWEsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUMxRCxNQUFNLFlBQVksR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3BELE1BQU0sZUFBZSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQzlELE1BQU0sWUFBWSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3JELE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyw2QkFBNkIsSUFBSSxZQUFZLENBQUM7UUFDbkUsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxtQkFBbUIsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzVFLE1BQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxTQUFTLElBQUksZUFBZSxDQUFDO1FBQ3hELE1BQU0sU0FBUyxHQUFHLEdBQUcsR0FBRyxZQUFZLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN6RSxNQUFNLFdBQVcsR0FBRyxLQUFLLENBQUMsV0FBVyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxDQUFDO1FBQ3BFLE1BQU0sVUFBVSxHQUFHLEtBQUssQ0FBQyxVQUFVLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksTUFBTSxDQUFDLENBQUM7UUFDaEUsTUFBTSxZQUFZLEdBQUcsS0FBSyxDQUFDLFlBQVksSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsSUFBSSxNQUFNLENBQUM7UUFDakYsTUFBTSxjQUFjLEdBQUcsS0FBSyxDQUFDLGNBQWMsSUFBSSxZQUFZLENBQUM7UUFDNUQsTUFBTSxjQUFjLEdBQUcsS0FBSyxDQUFDLGNBQWMsSUFBSSw4QkFBOEIsQ0FBQztRQUM5RSxNQUFNLGtCQUFrQixHQUFHLEtBQUssQ0FBQyxrQkFBa0IsSUFBSSxrQ0FBa0MsQ0FBQztRQUMxRixNQUFNLGtCQUFrQixHQUFHLEtBQUssQ0FBQyxrQkFBa0IsSUFBSSw0QkFBNEIsQ0FBQztRQUNwRixNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsbUJBQW1CLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsSUFBSSxpQkFBaUIsQ0FBQztRQUNsRyxNQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsY0FBYyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUM7UUFDakgsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLFlBQVksSUFBSSxFQUFFLENBQUM7UUFDeEMsTUFBTSxlQUFlLEdBQUcsT0FBTyxDQUFDLE9BQU8sSUFBSSxTQUFTLENBQUMsQ0FBQztRQUN0RCxNQUFNLGFBQWEsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdEMsTUFBTSxnQkFBZ0IsR0FBRyxLQUFLLENBQUMsYUFBYSxJQUFJLEtBQUssQ0FBQyxhQUFhLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztRQUUvRSxZQUFZO1FBQ1osSUFBSSxHQUFhLENBQUM7UUFDbEIsSUFBSSxnQkFBMEIsQ0FBQztRQUMvQixNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBRW5FLElBQUksQ0FBQyxlQUFlLElBQUksSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDcEQsR0FBRyxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxTQUFTLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQ3pFLElBQUksZ0JBQWdCLEVBQUUsQ0FBQztnQkFDckIsZ0JBQWdCLEdBQUcsS0FBSyxDQUFDLGFBQWMsQ0FBQztZQUMxQyxDQUFDO2lCQUFNLElBQUksS0FBSyxDQUFDLGNBQWMsSUFBSSxLQUFLLENBQUMsY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDbkUsZ0JBQWdCLEdBQUcsS0FBSyxDQUFDLGNBQWMsQ0FBQztZQUMxQyxDQUFDO2lCQUFNLENBQUM7Z0JBQ04sTUFBTSxLQUFLLEdBQUcsVUFBVSxDQUFDO2dCQUN6QixJQUFJLE9BQU8sR0FBRyxHQUFHLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsS0FBSyxLQUFLLENBQUMsQ0FBQztnQkFDM0UsSUFBSSxPQUFPLENBQUMsTUFBTSxLQUFLLENBQUM7b0JBQUUsT0FBTyxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixLQUFLLEtBQUssQ0FBQyxDQUFDO2dCQUNoRyxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQzVELElBQUksZ0JBQWdCLENBQUMsTUFBTSxHQUFHLENBQUM7b0JBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyxxREFBcUQsQ0FBQyxDQUFDO1lBQzFHLENBQUM7UUFDSCxDQUFDO2FBQU0sQ0FBQztZQUNOLE1BQU0sVUFBVSxHQUFHLElBQUksR0FBRyxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsWUFBWSxFQUFFLEVBQUUsSUFBSSxFQUFFLG1CQUFtQixFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUMsS0FBSyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDdkgsTUFBTSxXQUFXLEdBQUcsSUFBSSxHQUFHLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSx1QkFBdUIsRUFBRSxFQUFFLElBQUksRUFBRSxvQkFBb0IsRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQztZQUN4SixHQUFHLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsU0FBUyxFQUFFLEVBQUUsS0FBSyxFQUFFLFVBQVUsQ0FBQyxhQUFhLEVBQUUsaUJBQWlCLEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsRUFBRSxnQkFBZ0IsRUFBRSxXQUFXLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztZQUNySyxnQkFBZ0IsR0FBRyxLQUFLLENBQUMsY0FBYyxJQUFJLFdBQVcsQ0FBQyxXQUFXLENBQUM7UUFDckUsQ0FBQztRQUVELHVCQUF1QjtRQUN2QixNQUFNLFlBQVksR0FBRyxJQUFJLEdBQUcsQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLHlCQUF5QixFQUFFLEVBQUUsR0FBRyxFQUFFLFdBQVcsRUFBRSxrQ0FBa0MsRUFBRSxnQkFBZ0IsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQy9KLFlBQVksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO1FBRTVFLE1BQU0sU0FBUyxHQUFHLElBQUksR0FBRyxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUUsc0JBQXNCLEVBQUUsRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLGdDQUFnQyxFQUFFLGdCQUFnQixFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7UUFDdEosU0FBUyxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7UUFFMUUsaUJBQWlCO1FBQ2pCLE1BQU0sV0FBVyxHQUFHLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsYUFBYSxFQUFFLEVBQUUsWUFBWSxFQUFFLG1CQUFtQixFQUFFLFNBQVMsRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLFNBQVMsRUFBRSxhQUFhLEVBQUUsR0FBRyxDQUFDLGFBQWEsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1FBRXJMLG1CQUFtQjtRQUNuQixNQUFNLE9BQU8sR0FBRyxJQUFJLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLGFBQWEsRUFBRSxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsZ0JBQWdCLEVBQUUsOEJBQThCLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUduSSw4REFBOEQ7UUFDOUQsTUFBTSxXQUFXLEdBQUcsY0FBYyxDQUFDO1FBQ25DLE1BQU0sWUFBWSxHQUFHLElBQUksRUFBRSxDQUFDLGlCQUFpQixDQUFDLElBQUksRUFBRSxjQUFjLEVBQUU7WUFDbEUsUUFBUSxFQUFFLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsc0JBQXNCLEVBQUUsVUFBVSxFQUFFLEVBQUUsZUFBZSxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsRUFBRSxrQkFBa0IsRUFBRSxFQUFFLENBQUMsa0JBQWtCLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFO1lBQ3ZLLE1BQU0sRUFBRSxFQUFFLENBQUMsdUJBQXVCLENBQUMsWUFBWSxDQUFDLEVBQUUsU0FBUyxFQUFFLEVBQUUsQ0FBQyx1QkFBdUIsQ0FBQyxZQUFZLEVBQUUsQ0FBQztTQUN4RyxDQUFDLENBQUM7UUFDSCxNQUFNLGFBQWEsR0FBRyxJQUFJLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsZUFBZSxFQUFFO1lBQ3BFLFFBQVEsRUFBRSxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLGtCQUFrQixFQUFFLFVBQVUsRUFBRSxFQUFFLGNBQWMsRUFBRSxXQUFXLEVBQUUsa0JBQWtCLEVBQUUsU0FBUyxFQUFFLHVCQUF1QixFQUFFLEVBQUUsY0FBYyxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsa0JBQWtCLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSx3QkFBd0IsRUFBRSxrQ0FBa0MsRUFBRTtZQUNwVCxNQUFNLEVBQUUsRUFBRSxDQUFDLHVCQUF1QixDQUFDLFlBQVksQ0FBQyxFQUFFLFNBQVMsRUFBRSxFQUFFLENBQUMsdUJBQXVCLENBQUMsWUFBWSxFQUFFLENBQUM7U0FDeEcsQ0FBQyxDQUFDO1FBQ0gsYUFBYSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDL0MsTUFBTSxPQUFPLEdBQUcsR0FBRyxDQUFDLFVBQVUsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLEVBQUUsMEJBQTBCLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFFakcsK0RBQStEO1FBQy9ELE1BQU0sT0FBTyxHQUFHLElBQUksWUFBWSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsYUFBYSxFQUFFLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztRQUM3RyxNQUFNLFFBQVEsR0FBRyxJQUFJLFlBQVksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLGNBQWMsRUFBRSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxHQUFHLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7UUFFOUgsTUFBTSxhQUFhLEdBQUcsZUFBZSxDQUFDLENBQUMsQ0FBQyxJQUFJLFlBQVksQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLGVBQWUsRUFBRTtZQUM1RixVQUFVLEVBQUUsU0FBUyxFQUFFLHdCQUF3QixFQUFFLENBQUMsRUFBRSxjQUFjLEVBQUUsT0FBUSxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQUUsY0FBYyxFQUFFLFNBQVMsRUFBRSxDQUFDO1NBQ3JJLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO1FBRWYsTUFBTSxVQUFVLEdBQUcsZUFBZSxJQUFJLGFBQWEsQ0FBQyxDQUFDLENBQUMsSUFBSSxZQUFZLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxZQUFZLEVBQUU7WUFDdkcsS0FBSyxFQUFFLE9BQU8sQ0FBQyxHQUFHLEVBQUUsVUFBVSxFQUFFLGFBQWEsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxHQUFHLEVBQUUsYUFBYSxFQUFFLFVBQVU7U0FDbEcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7UUFDZixJQUFJLFVBQVUsSUFBSSxhQUFhLEVBQUUsQ0FBQztZQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLENBQUM7WUFBQyxVQUFVLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQUMsQ0FBQztRQUVqSCxNQUFNLFNBQVMsR0FBRyxlQUFlLElBQUksYUFBYSxJQUFJLGFBQWEsQ0FBQyxDQUFDLENBQUMsSUFBSSxPQUFPLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxpQkFBaUIsRUFBRTtZQUN0SCxZQUFZLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsRUFBRSxPQUFPLEVBQUUsYUFBYSxDQUFDLHNCQUFzQixFQUFFLFlBQVksRUFBRSxhQUFhLENBQUMsd0JBQXdCLEVBQUU7U0FDdkssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7UUFDZixJQUFJLFNBQVMsSUFBSSxhQUFhO1lBQUUsU0FBUyxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUV2RSxNQUFNLE9BQU8sR0FBRyxlQUFlLENBQUMsQ0FBQyxDQUFDLFdBQVcsU0FBUyx3QkFBd0IsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUUsUUFBUSxDQUFDLEdBQUcsRUFBRSxlQUFlLENBQUMsQ0FBQyxDQUFDO1FBRWhLLDJCQUEyQjtRQUMzQixNQUFNLFNBQVMsR0FBRyxJQUFJLGdCQUFnQixDQUFDLG1CQUFtQixDQUFDLElBQUksRUFBRSxrQkFBa0IsRUFBRSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFdBQVcsRUFBRSw2QkFBNkIsRUFBRSxDQUFDLENBQUM7UUFFeEosZ0JBQWdCO1FBQ2hCLE1BQU0sT0FBTyxHQUFHLElBQUksWUFBWSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsWUFBWSxFQUFFLEVBQUUsSUFBSSxFQUFFLHNCQUFzQixFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxnQkFBZ0IsRUFBRSxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFakwseUJBQXlCO1FBQ3pCLE1BQU0sZUFBZSxHQUFHLElBQUksZ0JBQWdCLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxvQkFBb0IsRUFBRTtZQUMvRSxJQUFJLEVBQUUsY0FBYyxFQUFFLFNBQVMsRUFBRSxhQUFhLEVBQUUsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLGFBQWEsRUFBRSxnQkFBZ0IsQ0FBQyxhQUFhLENBQUMsUUFBUSxFQUFFLGlCQUFpQixFQUFFLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyxFQUFFO1NBQ3RNLENBQUMsQ0FBQztRQUVILDBEQUEwRDtRQUMxRCxNQUFNLFVBQVUsR0FBRyxJQUFJLGNBQWMsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLFlBQVksRUFBRTtZQUMvRCxVQUFVLEVBQUUsR0FBRyxTQUFTLFNBQVM7WUFDakMsV0FBVyxFQUFFLDRDQUE0QztZQUN6RCxpQkFBaUIsRUFBRTtnQkFDakIsZ0JBQWdCLEVBQUUsR0FBRyxDQUFDLFdBQVcsQ0FBQyxlQUFlLENBQUMsY0FBYyxDQUFDO2dCQUNqRSxvQkFBb0IsRUFBRSxHQUFHLENBQUMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxrQkFBa0IsQ0FBQztnQkFDekUsY0FBYyxFQUFFLEdBQUcsQ0FBQyxXQUFXLENBQUMsZUFBZSxDQUFDLGtCQUFrQixDQUFDO2dCQUNuRSxRQUFRLEVBQUUsR0FBRyxDQUFDLFdBQVcsQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUM3RCxJQUFJLEVBQUUsR0FBRyxDQUFDLFdBQVcsQ0FBQyxlQUFlLENBQUMsYUFBYSxDQUFDLFFBQVEsRUFBRSxDQUFDO2FBQ2hFO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsaUJBQWlCO1FBQ2pCLE1BQU0sWUFBWSxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsbUJBQW1CLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxHQUFHLENBQUMsZ0JBQWdCLENBQUMseUJBQXlCLENBQUMsRUFBRSxlQUFlLEVBQUUsQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLHdCQUF3QixDQUFDLCtDQUErQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDalAsWUFBWSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxlQUFlLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxrQkFBa0IsRUFBRSxtQkFBbUIsRUFBRSx5QkFBeUIsRUFBRSxhQUFhLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxlQUFlLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLE9BQU8sYUFBYSxTQUFTLEdBQUcsRUFBRSxlQUFlLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLE9BQU8sUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDMVIsWUFBWSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxlQUFlLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQywrQkFBK0IsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUVySSxNQUFNLFFBQVEsR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLFVBQVUsRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyx5QkFBeUIsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNwSCxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksR0FBRyxDQUFDLGVBQWUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLGtCQUFrQixFQUFFLG1CQUFtQixFQUFFLHlCQUF5QixFQUFFLGFBQWEsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLGVBQWUsSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsT0FBTyxhQUFhLFNBQVMsR0FBRyxFQUFFLGVBQWUsSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsT0FBTyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN0UixRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksR0FBRyxDQUFDLGVBQWUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLCtCQUErQixDQUFDLEVBQUUsU0FBUyxFQUFFLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRWpJLDJCQUEyQjtRQUMzQixNQUFNLE9BQU8sR0FBRyxJQUFJLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLEVBQUUsbUJBQW1CLEVBQUUsRUFBRSxNQUFNLEVBQUUsY0FBYyxFQUFFLEdBQUcsRUFBRSxZQUFZLEVBQUUsY0FBYyxFQUFFLGVBQWUsRUFBRSxhQUFhLEVBQUUsWUFBWSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFDaE0sT0FBTyxDQUFDLFlBQVksQ0FBQyxjQUFjLEVBQUU7WUFDbkMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxjQUFjLENBQUMsaUJBQWlCLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxFQUFFLFlBQVksRUFBRSxDQUFDLEVBQUUsYUFBYSxFQUFFLENBQUM7WUFDakcsT0FBTyxFQUFFLEdBQUcsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsY0FBYyxFQUFFLENBQUM7WUFDeEYsV0FBVyxFQUFFLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxhQUFhLENBQUMsUUFBUSxFQUFFLEVBQUUsUUFBUSxFQUFFLE9BQU8sQ0FBQyxRQUFRLEVBQUUsRUFBRSxRQUFRLEVBQUUsY0FBYyxFQUFFO1lBQ3JJLE9BQU8sRUFBRTtnQkFDUCxnQkFBZ0IsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLFVBQVUsRUFBRSxrQkFBa0IsQ0FBQztnQkFDL0Usb0JBQW9CLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxVQUFVLEVBQUUsc0JBQXNCLENBQUM7Z0JBQ3ZGLGNBQWMsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLFVBQVUsRUFBRSxnQkFBZ0IsQ0FBQzthQUM1RTtTQUNGLENBQUMsQ0FBQztRQUVILDZGQUE2RjtRQUM3RixNQUFNLE9BQU8sR0FBRyxJQUFJLEdBQUcsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLFlBQVksRUFBRTtZQUN6RCxXQUFXLEVBQUUsY0FBYyxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsT0FBTyxFQUFFLFlBQVk7WUFDM0UsMEJBQTBCLEVBQUUsQ0FBQyxFQUFFLGdCQUFnQixFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxnQkFBZ0IsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxDQUFDO1lBQ3pILFVBQVUsRUFBRSxFQUFFLE9BQU8sRUFBRSxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsZ0JBQWdCLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUU7WUFDaEgsY0FBYyxFQUFFLENBQUMsU0FBUyxDQUFDLEVBQUUsY0FBYyxFQUFFLGdCQUFnQixJQUFJLEtBQUssRUFBRSxpQkFBaUIsRUFBRSxFQUFFLEVBQUUsaUJBQWlCLEVBQUUsR0FBRztTQUN0SCxDQUFDLENBQUM7UUFDSCxPQUFPLENBQUMsd0JBQXdCLENBQUMsRUFBRSxPQUFPLEVBQUUsZUFBZSxFQUFFLGFBQWEsRUFBRSxTQUFTLEVBQUUsT0FBTyxDQUFDLGdCQUFpQixFQUFFLENBQUMsQ0FBQztRQUVwSCwrQkFBK0I7UUFDL0IsTUFBTSxXQUFXLEdBQUcsSUFBSSxZQUFZLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxpQkFBaUIsRUFBRSxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsR0FBRyxFQUFFLGVBQWUsRUFBRSxZQUFZLEVBQUUsaUJBQWlCLEVBQUUsS0FBSyxFQUFFLGNBQWMsRUFBRSxlQUFlLENBQUMsVUFBVSxFQUFFLGNBQWMsRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLE9BQU8sQ0FBQyxHQUFHLEVBQUUsb0JBQW9CLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUM5UixJQUFJLFlBQVksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLGtCQUFrQixFQUFFLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxHQUFHLEVBQUUsUUFBUSxFQUFFLG1CQUFtQixFQUFFLE1BQU0sRUFBRSxnQkFBZ0IsV0FBVyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUN0SixJQUFJLFlBQVksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLHVCQUF1QixFQUFFLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxHQUFHLEVBQUUsUUFBUSxFQUFFLDRCQUE0QixFQUFFLE1BQU0sRUFBRSxnQkFBZ0IsV0FBVyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUVwSyxzQkFBc0I7UUFDdEIsTUFBTSxTQUFTLEdBQUcsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxlQUFlLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxHQUFHLENBQUMsZ0JBQWdCLENBQUMseUJBQXlCLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDMUgsU0FBUyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxlQUFlLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxxQkFBcUIsRUFBRSxzQkFBc0IsRUFBRSxtQkFBbUIsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3BKLFNBQVMsQ0FBQyxXQUFXLENBQUMsSUFBSSxHQUFHLENBQUMsZUFBZSxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsMkJBQTJCLEVBQUUsaUNBQWlDLEVBQUUseUJBQXlCLEVBQUUsbUJBQW1CLEVBQUUsMEJBQTBCLEVBQUUseUJBQXlCLEVBQUUsY0FBYyxFQUFFLHFCQUFxQixDQUFDLEVBQUUsU0FBUyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDOVIsU0FBUyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxlQUFlLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxtQkFBbUIsRUFBRSxzQkFBc0IsRUFBRSxzQkFBc0IsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3JKLFNBQVMsQ0FBQyxXQUFXLENBQUMsSUFBSSxHQUFHLENBQUMsZUFBZSxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsa0JBQWtCLEVBQUUsbUJBQW1CLEVBQUUseUJBQXlCLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNwSixJQUFJLEtBQUssQ0FBQyxpQkFBaUI7WUFBRSxTQUFTLENBQUMsV0FBVyxDQUFDLElBQUksR0FBRyxDQUFDLGVBQWUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLCtCQUErQixFQUFFLG9DQUFvQyxFQUFFLCtCQUErQixDQUFDLEVBQUUsU0FBUyxFQUFFLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFek8seUJBQXlCO1FBQ3pCLElBQUksU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsa0JBQWtCLEVBQUU7WUFDOUMsV0FBVyxFQUFFLGNBQWMsRUFBRSxJQUFJLEVBQUUsU0FBUztZQUM1QyxXQUFXLEVBQUUsRUFBRSxVQUFVLEVBQUUsU0FBUyxDQUFDLGVBQWUsQ0FBQyxZQUFZLEVBQUUsV0FBVyxFQUFFLFNBQVMsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsb0JBQW9CLEVBQUUsRUFBRSxPQUFPLEVBQUUsRUFBRSxLQUFLLEVBQUUsT0FBTyxDQUFDLGFBQWEsRUFBRSxFQUFFLFlBQVksRUFBRSxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsV0FBVyxFQUFFLEVBQUUsWUFBWSxFQUFFLEVBQUUsS0FBSyxFQUFFLGNBQWMsRUFBRSxFQUFFLEVBQUU7WUFDM1IsTUFBTSxFQUFFLFNBQVMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsQ0FBQztZQUNwRyxPQUFPLEVBQUUsR0FBRyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEVBQUUsYUFBYSxFQUFFLEdBQUcsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLDBEQUEwRDtZQUNoSyxTQUFTLEVBQUUsU0FBUyxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUM7Z0JBQ3hDLE9BQU8sRUFBRSxLQUFLO2dCQUNkLE1BQU0sRUFBRTtvQkFDTixTQUFTLEVBQUUsRUFBRSxRQUFRLEVBQUUsQ0FBQywwQkFBMEIsRUFBRSxpSEFBaUgsRUFBRSx3REFBd0QsQ0FBQyxFQUFFO29CQUNsTyxLQUFLLEVBQUUsRUFBRSxRQUFRLEVBQUUsQ0FBQywwQkFBMEIsRUFBRSwwREFBMEQsQ0FBQyxFQUFFO29CQUM3RyxVQUFVLEVBQUUsRUFBRSxRQUFRLEVBQUUsQ0FBQyw2QkFBNkIsRUFBRSxpQ0FBaUMsRUFBRSwrRkFBK0YsQ0FBQyxFQUFFO2lCQUM5TDtnQkFDRCxTQUFTLEVBQUUsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRTthQUNqRCxDQUFDO1NBQ0gsQ0FBQyxDQUFDO1FBRUgsVUFBVTtRQUNWLElBQUksQ0FBQyxXQUFXLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQztRQUN2QyxJQUFJLEdBQUcsQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLGFBQWEsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztRQUNwRSxJQUFJLENBQUMsYUFBYSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUM7UUFDM0MsSUFBSSxHQUFHLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxlQUFlLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUM7UUFDeEUsSUFBSSxDQUFDLFlBQVksR0FBRyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDdkMsSUFBSSxHQUFHLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxjQUFjLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUM7UUFDdEUsSUFBSSxDQUFDLGtCQUFrQixHQUFHLGVBQWUsQ0FBQyxVQUFVLENBQUM7UUFDckQsSUFBSSxHQUFHLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxvQkFBb0IsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDO0lBQ3BGLENBQUM7Q0FDRjtBQWxORCxrREFrTkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBjZGsgZnJvbSAnYXdzLWNkay1saWInO1xyXG5pbXBvcnQgKiBhcyBhcGlnYXRld2F5djIgZnJvbSAnYXdzLWNkay1saWIvYXdzLWFwaWdhdGV3YXl2Mic7XHJcbmltcG9ydCAqIGFzIGNvZGVidWlsZCBmcm9tICdhd3MtY2RrLWxpYi9hd3MtY29kZWJ1aWxkJztcclxuaW1wb3J0ICogYXMgY3IgZnJvbSAnYXdzLWNkay1saWIvY3VzdG9tLXJlc291cmNlcyc7XHJcbmltcG9ydCAqIGFzIGVjMiBmcm9tICdhd3MtY2RrLWxpYi9hd3MtZWMyJztcclxuaW1wb3J0ICogYXMgZWNyIGZyb20gJ2F3cy1jZGstbGliL2F3cy1lY3InO1xyXG5pbXBvcnQgKiBhcyBlY3MgZnJvbSAnYXdzLWNkay1saWIvYXdzLWVjcyc7XHJcbmltcG9ydCAqIGFzIGlhbSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtaWFtJztcclxuaW1wb3J0ICogYXMgbG9ncyBmcm9tICdhd3MtY2RrLWxpYi9hd3MtbG9ncyc7XHJcbmltcG9ydCAqIGFzIHJvdXRlNTMgZnJvbSAnYXdzLWNkay1saWIvYXdzLXJvdXRlNTMnO1xyXG5pbXBvcnQgKiBhcyBzZXJ2aWNlZGlzY292ZXJ5IGZyb20gJ2F3cy1jZGstbGliL2F3cy1zZXJ2aWNlZGlzY292ZXJ5JztcclxuaW1wb3J0ICogYXMgc2VjcmV0c21hbmFnZXIgZnJvbSAnYXdzLWNkay1saWIvYXdzLXNlY3JldHNtYW5hZ2VyJztcclxuaW1wb3J0ICogYXMgc3NtIGZyb20gJ2F3cy1jZGstbGliL2F3cy1zc20nO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBHbWFpbFZpZXdlckNka1N0YWNrUHJvcHMgZXh0ZW5kcyBjZGsuU3RhY2tQcm9wcyB7XHJcbiAgcmVhZG9ubHkgdnBjSWQ/OiBzdHJpbmc7XHJcbiAgcmVhZG9ubHkgcHJpdmF0ZVN1Ym5ldHM/OiBzdHJpbmdbXTtcclxuICByZWFkb25seSBwdWJsaWNTdWJuZXRzPzogc3RyaW5nW107XHJcbiAgcmVhZG9ubHkgY29udGFpbmVyUG9ydD86IG51bWJlciB8IHN0cmluZztcclxuICByZWFkb25seSBjb250YWluZXJDcHU/OiBudW1iZXIgfCBzdHJpbmc7XHJcbiAgcmVhZG9ubHkgY29udGFpbmVyTWVtb3J5PzogbnVtYmVyIHwgc3RyaW5nO1xyXG4gIHJlYWRvbmx5IGRlc2lyZWRDb3VudD86IG51bWJlciB8IHN0cmluZztcclxuICByZWFkb25seSBjZXJ0aWZpY2F0ZUFybj86IHN0cmluZztcclxuICByZWFkb25seSBhcGlDdXN0b21Eb21haW5OYW1lPzogc3RyaW5nO1xyXG4gIHJlYWRvbmx5IGhvc3RlZFpvbmVJZD86IHN0cmluZztcclxuICByZWFkb25seSBzZXJ2aWNlRGlzY292ZXJ5TmFtZXNwYWNlTmFtZT86IHN0cmluZztcclxuICByZWFkb25seSBzZXJ2aWNlRGlzY292ZXJ5VHRsPzogbnVtYmVyIHwgc3RyaW5nO1xyXG4gIHJlYWRvbmx5IHNzbVByZWZpeD86IHN0cmluZztcclxuICByZWFkb25seSBnaXRIdWJPd25lcj86IHN0cmluZztcclxuICByZWFkb25seSBnaXRIdWJSZXBvPzogc3RyaW5nO1xyXG4gIHJlYWRvbmx5IGdpdEh1YkJyYW5jaD86IHN0cmluZztcclxuICByZWFkb25seSBwdWJsaWNFbnZWYWx1ZT86IHN0cmluZztcclxuICByZWFkb25seSBnb29nbGVDbGllbnRJZD86IHN0cmluZztcclxuICByZWFkb25seSBnb29nbGVDbGllbnRTZWNyZXQ/OiBzdHJpbmc7XHJcbiAgcmVhZG9ubHkgc2Vzc2lvblNlY3JldFZhbHVlPzogc3RyaW5nO1xyXG4gIHJlYWRvbmx5IHVzZUdpdEh1YldlYmhvb2tzPzogYm9vbGVhbjtcclxuICByZWFkb25seSBjb2RlQ29ubmVjdGlvbkFybj86IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEdtYWlsVmlld2VyQ2RrU3RhY2sgZXh0ZW5kcyBjZGsuU3RhY2sge1xyXG4gIHB1YmxpYyByZWFkb25seSBjbHVzdGVyTmFtZTogc3RyaW5nO1xyXG4gIHB1YmxpYyByZWFkb25seSByZXBvc2l0b3J5VXJpOiBzdHJpbmc7XHJcbiAgcHVibGljIHJlYWRvbmx5IGFwaUludm9rZVVybDogc3RyaW5nO1xyXG4gIHB1YmxpYyByZWFkb25seSBjbG91ZE1hcFNlcnZpY2VBcm46IHN0cmluZztcclxuXHJcbiAgcHVibGljIGNvbnN0cnVjdG9yKHNjb3BlOiBjZGsuQXBwLCBpZDogc3RyaW5nLCBwcm9wczogR21haWxWaWV3ZXJDZGtTdGFja1Byb3BzKSB7XHJcbiAgICBzdXBlcihzY29wZSwgaWQsIHByb3BzKTtcclxuXHJcbiAgICBjb25zdCB0b051bWJlciA9ICh2YWx1ZTogc3RyaW5nIHwgbnVtYmVyIHwgdW5kZWZpbmVkLCBmYWxsYmFjazogbnVtYmVyKTogbnVtYmVyID0+IHtcclxuICAgICAgY29uc3QgY2FuZGlkYXRlID0gdmFsdWUgPz8gZmFsbGJhY2s7XHJcbiAgICAgIGNvbnN0IHBhcnNlZCA9IHR5cGVvZiBjYW5kaWRhdGUgPT09ICdudW1iZXInID8gY2FuZGlkYXRlIDogTnVtYmVyKGNhbmRpZGF0ZSk7XHJcbiAgICAgIHJldHVybiBOdW1iZXIuaXNGaW5pdGUocGFyc2VkKSA/IHBhcnNlZCA6IGZhbGxiYWNrO1xyXG4gICAgfTtcclxuICAgIGNvbnN0IHRvQ3B1VW5pdHMgPSAodmFsdWU6IHN0cmluZyB8IG51bWJlciB8IHVuZGVmaW5lZCk6IG51bWJlciA9PiB7XHJcbiAgICAgIGNvbnN0IHBhcnNlZCA9IHRvTnVtYmVyKHZhbHVlLCAwLjUpO1xyXG4gICAgICBjb25zdCB2Y3B1ID0gcGFyc2VkIDw9IDQgPyBwYXJzZWQgKiAxMDI0IDogcGFyc2VkO1xyXG4gICAgICByZXR1cm4gTWF0aC5tYXgoMjU2LCBNYXRoLnJvdW5kKHZjcHUgLyAyNTYpICogMjU2KTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgcmVwb1BhcnRzID0gKHByb2Nlc3MuZW52LkdJVEhVQl9SRVBPU0lUT1JZID8/ICcnKS5zcGxpdCgnLycpO1xyXG4gICAgY29uc3QgY29udGFpbmVyUG9ydCA9IHRvTnVtYmVyKHByb3BzLmNvbnRhaW5lclBvcnQsIDMwMDApO1xyXG4gICAgY29uc3QgY29udGFpbmVyQ3B1ID0gdG9DcHVVbml0cyhwcm9wcy5jb250YWluZXJDcHUpO1xyXG4gICAgY29uc3QgY29udGFpbmVyTWVtb3J5ID0gdG9OdW1iZXIocHJvcHMuY29udGFpbmVyTWVtb3J5LCAxMDI0KTtcclxuICAgIGNvbnN0IGRlc2lyZWRDb3VudCA9IHRvTnVtYmVyKHByb3BzLmRlc2lyZWRDb3VudCwgMSk7XHJcbiAgICBjb25zdCBuc05hbWUgPSBwcm9wcy5zZXJ2aWNlRGlzY292ZXJ5TmFtZXNwYWNlTmFtZSA/PyAnbWFpbC5sb2NhbCc7XHJcbiAgICBjb25zdCBuc1R0bCA9IGNkay5EdXJhdGlvbi5zZWNvbmRzKHRvTnVtYmVyKHByb3BzLnNlcnZpY2VEaXNjb3ZlcnlUdGwsIDYwKSk7XHJcbiAgICBjb25zdCBzc21QcmVmaXhSYXcgPSBwcm9wcy5zc21QcmVmaXggPz8gJy9tYWlsLWV4YW1wbGUnO1xyXG4gICAgY29uc3Qgc3NtUHJlZml4ID0gJy8nICsgc3NtUHJlZml4UmF3LnNwbGl0KCcvJykuZmlsdGVyKHAgPT4gcCkuam9pbignLycpO1xyXG4gICAgY29uc3QgZ2l0SHViT3duZXIgPSBwcm9wcy5naXRIdWJPd25lciA/PyAocmVwb1BhcnRzWzBdIHx8ICdkeWFuZXQnKTtcclxuICAgIGNvbnN0IGdpdEh1YlJlcG8gPSBwcm9wcy5naXRIdWJSZXBvID8/IChyZXBvUGFydHNbMV0gfHwgJ2ltYXAnKTtcclxuICAgIGNvbnN0IGdpdEh1YkJyYW5jaCA9IHByb3BzLmdpdEh1YkJyYW5jaCA/PyBwcm9jZXNzLmVudi5HSVRIVUJfUkVGX05BTUUgPz8gJ21haW4nO1xyXG4gICAgY29uc3QgcHVibGljRW52VmFsdWUgPSBwcm9wcy5wdWJsaWNFbnZWYWx1ZSA/PyAncHJvZHVjdGlvbic7XHJcbiAgICBjb25zdCBnb29nbGVDbGllbnRJZCA9IHByb3BzLmdvb2dsZUNsaWVudElkIHx8ICdQTEFDRUhPTERFUl9HT09HTEVfQ0xJRU5UX0lEJztcclxuICAgIGNvbnN0IGdvb2dsZUNsaWVudFNlY3JldCA9IHByb3BzLmdvb2dsZUNsaWVudFNlY3JldCB8fCAnUExBQ0VIT0xERVJfR09PR0xFX0NMSUVOVF9TRUNSRVQnO1xyXG4gICAgY29uc3Qgc2Vzc2lvblNlY3JldFZhbHVlID0gcHJvcHMuc2Vzc2lvblNlY3JldFZhbHVlIHx8ICdQTEFDRUhPTERFUl9TRVNTSU9OX1NFQ1JFVCc7XHJcbiAgICBjb25zdCBhcGlEb21haW4gPSBwcm9wcy5hcGlDdXN0b21Eb21haW5OYW1lID8/IHByb2Nlc3MuZW52LkFQSV9DVVNUT01fRE9NQUlOID8/ICdkZW1vLmR5YW5ldC5jb20nO1xyXG4gICAgY29uc3QgY2VydEFybiA9IHByb3BzLmNlcnRpZmljYXRlQXJuID8/IHRoaXMubm9kZS50cnlHZXRDb250ZXh0KCdjZXJ0aWZpY2F0ZUFybicpID8/IHByb2Nlc3MuZW52LkNFUlRJRklDQVRFX0FSTjtcclxuICAgIGNvbnN0IHpvbmVJZCA9IHByb3BzLmhvc3RlZFpvbmVJZCA/PyAnJztcclxuICAgIGNvbnN0IGhhc0N1c3RvbURvbWFpbiA9IEJvb2xlYW4oY2VydEFybiAmJiBhcGlEb21haW4pO1xyXG4gICAgY29uc3QgaGFzSG9zdGVkWm9uZSA9IEJvb2xlYW4oem9uZUlkKTtcclxuICAgIGNvbnN0IHVzZVB1YmxpY1N1Ym5ldHMgPSBwcm9wcy5wdWJsaWNTdWJuZXRzICYmIHByb3BzLnB1YmxpY1N1Ym5ldHMubGVuZ3RoID4gMDtcclxuXHJcbiAgICAvLyBWUEMgc2V0dXBcclxuICAgIGxldCB2cGM6IGVjMi5JVnBjO1xyXG4gICAgbGV0IHNlcnZpY2VTdWJuZXRJZHM6IHN0cmluZ1tdO1xyXG4gICAgY29uc3QgdXNlVnBjUGFyYW1ldGVyID0gdGhpcy5ub2RlLnRyeUdldENvbnRleHQoJ3VzZVZwY1BhcmFtZXRlcicpO1xyXG5cclxuICAgIGlmICghdXNlVnBjUGFyYW1ldGVyICYmIHRoaXMuYWNjb3VudCAmJiB0aGlzLnJlZ2lvbikge1xyXG4gICAgICB2cGMgPSBlYzIuVnBjLmZyb21Mb29rdXAodGhpcywgJ01haWxWcGMnLCB7IHRhZ3M6IHsgTmFtZTogJ2R5YS12cGMnIH0gfSk7XHJcbiAgICAgIGlmICh1c2VQdWJsaWNTdWJuZXRzKSB7XHJcbiAgICAgICAgc2VydmljZVN1Ym5ldElkcyA9IHByb3BzLnB1YmxpY1N1Ym5ldHMhO1xyXG4gICAgICB9IGVsc2UgaWYgKHByb3BzLnByaXZhdGVTdWJuZXRzICYmIHByb3BzLnByaXZhdGVTdWJuZXRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBzZXJ2aWNlU3VibmV0SWRzID0gcHJvcHMucHJpdmF0ZVN1Ym5ldHM7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgYmFkQXogPSAnY2FjMS1hejQnO1xyXG4gICAgICAgIGxldCBzdWJuZXRzID0gdnBjLnByaXZhdGVTdWJuZXRzLmZpbHRlcihzID0+IHMuYXZhaWxhYmlsaXR5Wm9uZSAhPT0gYmFkQXopO1xyXG4gICAgICAgIGlmIChzdWJuZXRzLmxlbmd0aCA9PT0gMCkgc3VibmV0cyA9IHZwYy5wdWJsaWNTdWJuZXRzLmZpbHRlcihzID0+IHMuYXZhaWxhYmlsaXR5Wm9uZSAhPT0gYmFkQXopO1xyXG4gICAgICAgIHNlcnZpY2VTdWJuZXRJZHMgPSBzdWJuZXRzLnNsaWNlKDAsIDIpLm1hcChzID0+IHMuc3VibmV0SWQpO1xyXG4gICAgICAgIGlmIChzZXJ2aWNlU3VibmV0SWRzLmxlbmd0aCA8IDEpIHRocm93IG5ldyBFcnJvcihgVlBDIG11c3QgaGF2ZSBhdCBsZWFzdCBvbmUgc3VibmV0IGluIGFuIGFsbG93ZWQgQVouYCk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IHZwY0lkUGFyYW0gPSBuZXcgY2RrLkNmblBhcmFtZXRlcih0aGlzLCAnVnBjSWRQYXJhbScsIHsgdHlwZTogJ0FXUzo6RUMyOjpWUEM6OklkJywgZGVmYXVsdDogcHJvcHMudnBjSWQgPz8gJycgfSk7XHJcbiAgICAgIGNvbnN0IHN1Ym5ldFBhcmFtID0gbmV3IGNkay5DZm5QYXJhbWV0ZXIodGhpcywgJ1ByaXZhdGVTdWJuZXRJZHNQYXJhbScsIHsgdHlwZTogJ0NvbW1hRGVsaW1pdGVkTGlzdCcsIGRlZmF1bHQ6IHByb3BzLnByaXZhdGVTdWJuZXRzPy5qb2luKCcsJykgPz8gJycgfSk7XHJcbiAgICAgIHZwYyA9IGVjMi5WcGMuZnJvbVZwY0F0dHJpYnV0ZXModGhpcywgJ01haWxWcGMnLCB7IHZwY0lkOiB2cGNJZFBhcmFtLnZhbHVlQXNTdHJpbmcsIGF2YWlsYWJpbGl0eVpvbmVzOiBjZGsuRm4uZ2V0QXpzKCksIHByaXZhdGVTdWJuZXRJZHM6IHN1Ym5ldFBhcmFtLnZhbHVlQXNMaXN0IH0pO1xyXG4gICAgICBzZXJ2aWNlU3VibmV0SWRzID0gcHJvcHMucHJpdmF0ZVN1Ym5ldHMgPz8gc3VibmV0UGFyYW0udmFsdWVBc0xpc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2VjdXJpdHkgR3JvdXBzIChMMilcclxuICAgIGNvbnN0IGFwaVZwY0xpbmtTZyA9IG5ldyBlYzIuU2VjdXJpdHlHcm91cCh0aGlzLCAnQXBpVnBjTGlua1NlY3VyaXR5R3JvdXAnLCB7IHZwYywgZGVzY3JpcHRpb246ICdFZ3Jlc3MgZnJvbSBBUEkgR2F0ZXdheSBWUEMgTGluaycsIGFsbG93QWxsT3V0Ym91bmQ6IGZhbHNlIH0pO1xyXG4gICAgYXBpVnBjTGlua1NnLmFkZEVncmVzc1J1bGUoZWMyLlBlZXIuYW55SXB2NCgpLCBlYzIuUG9ydC50Y3AoY29udGFpbmVyUG9ydCkpO1xyXG5cclxuICAgIGNvbnN0IHNlcnZpY2VTZyA9IG5ldyBlYzIuU2VjdXJpdHlHcm91cCh0aGlzLCAnU2VydmljZVNlY3VyaXR5R3JvdXAnLCB7IHZwYywgZGVzY3JpcHRpb246ICdBbGxvdyB0cmFmZmljIHRvIEZhcmdhdGUgdGFza3MnLCBhbGxvd0FsbE91dGJvdW5kOiB0cnVlIH0pO1xyXG4gICAgc2VydmljZVNnLmFkZEluZ3Jlc3NSdWxlKGVjMi5QZWVyLmFueUlwdjQoKSwgZWMyLlBvcnQudGNwKGNvbnRhaW5lclBvcnQpKTtcclxuXHJcbiAgICAvLyBMb2cgR3JvdXAgKEwyKVxyXG4gICAgY29uc3QgYXBwTG9nR3JvdXAgPSBuZXcgbG9ncy5Mb2dHcm91cCh0aGlzLCAnQXBwTG9nR3JvdXAnLCB7IGxvZ0dyb3VwTmFtZTogJy9lY3MvbWFpbC1leGFtcGxlJywgcmV0ZW50aW9uOiBsb2dzLlJldGVudGlvbkRheXMuT05FX01PTlRILCByZW1vdmFsUG9saWN5OiBjZGsuUmVtb3ZhbFBvbGljeS5ERVNUUk9ZIH0pO1xyXG5cclxuICAgIC8vIEVDUyBDbHVzdGVyIChMMilcclxuICAgIGNvbnN0IGNsdXN0ZXIgPSBuZXcgZWNzLkNsdXN0ZXIodGhpcywgJ01haWxDbHVzdGVyJywgeyB2cGMsIGNsdXN0ZXJOYW1lOiAncHVibGljLWNsdXN0ZXInLCBlbmFibGVGYXJnYXRlQ2FwYWNpdHlQcm92aWRlcnM6IHRydWUgfSk7XHJcblxyXG5cclxuICAgIC8vIEVDUiBSZXBvc2l0b3J5IC0gY3JlYXRlIGlmIG5vdCBleGlzdHMgdXNpbmcgY3VzdG9tIHJlc291cmNlXHJcbiAgICBjb25zdCBlY3JSZXBvTmFtZSA9ICdtYWlsLWV4YW1wbGUnO1xyXG4gICAgY29uc3QgY2hlY2tFY3JSZXBvID0gbmV3IGNyLkF3c0N1c3RvbVJlc291cmNlKHRoaXMsICdDaGVja0VjclJlcG8nLCB7XHJcbiAgICAgIG9uQ3JlYXRlOiB7IHNlcnZpY2U6ICdFQ1InLCBhY3Rpb246ICdkZXNjcmliZVJlcG9zaXRvcmllcycsIHBhcmFtZXRlcnM6IHsgcmVwb3NpdG9yeU5hbWVzOiBbZWNyUmVwb05hbWVdIH0sIHBoeXNpY2FsUmVzb3VyY2VJZDogY3IuUGh5c2ljYWxSZXNvdXJjZUlkLm9mKGVjclJlcG9OYW1lKSB9LFxyXG4gICAgICBwb2xpY3k6IGNyLkF3c0N1c3RvbVJlc291cmNlUG9saWN5LmZyb21TZGtDYWxscyh7IHJlc291cmNlczogY3IuQXdzQ3VzdG9tUmVzb3VyY2VQb2xpY3kuQU5ZX1JFU09VUkNFIH0pLFxyXG4gICAgfSk7XHJcbiAgICBjb25zdCBjcmVhdGVFY3JSZXBvID0gbmV3IGNyLkF3c0N1c3RvbVJlc291cmNlKHRoaXMsICdDcmVhdGVFY3JSZXBvJywge1xyXG4gICAgICBvbkNyZWF0ZTogeyBzZXJ2aWNlOiAnRUNSJywgYWN0aW9uOiAnY3JlYXRlUmVwb3NpdG9yeScsIHBhcmFtZXRlcnM6IHsgcmVwb3NpdG9yeU5hbWU6IGVjclJlcG9OYW1lLCBpbWFnZVRhZ011dGFiaWxpdHk6ICdNVVRBQkxFJywgZW5jcnlwdGlvbkNvbmZpZ3VyYXRpb246IHsgZW5jcnlwdGlvblR5cGU6ICdBRVMyNTYnIH0gfSwgcGh5c2ljYWxSZXNvdXJjZUlkOiBjci5QaHlzaWNhbFJlc291cmNlSWQub2YoZWNyUmVwb05hbWUpLCBpZ25vcmVFcnJvckNvZGVzTWF0Y2hpbmc6ICdSZXBvc2l0b3J5QWxyZWFkeUV4aXN0c0V4Y2VwdGlvbicgfSxcclxuICAgICAgcG9saWN5OiBjci5Bd3NDdXN0b21SZXNvdXJjZVBvbGljeS5mcm9tU2RrQ2FsbHMoeyByZXNvdXJjZXM6IGNyLkF3c0N1c3RvbVJlc291cmNlUG9saWN5LkFOWV9SRVNPVVJDRSB9KSxcclxuICAgIH0pO1xyXG4gICAgY3JlYXRlRWNyUmVwby5ub2RlLmFkZERlcGVuZGVuY3koY2hlY2tFY3JSZXBvKTtcclxuICAgIGNvbnN0IGVjclJlcG8gPSBlY3IuUmVwb3NpdG9yeS5mcm9tUmVwb3NpdG9yeU5hbWUodGhpcywgJ01haWxFeGFtcGxlUmVwb3NpdG9yeVJlZicsIGVjclJlcG9OYW1lKTtcclxuXHJcbiAgICAvLyBBUEkgR2F0ZXdheSBIVFRQIEFQSSAoTDEgLSBubyBMMiBmb3IgSFRUUCBBUEkgd2l0aCBWUEMgTGluaylcclxuICAgIGNvbnN0IGh0dHBBcGkgPSBuZXcgYXBpZ2F0ZXdheXYyLkNmbkFwaSh0aGlzLCAnTWFpbEh0dHBBcGknLCB7IG5hbWU6ICdtYWlsLWV4YW1wbGUnLCBwcm90b2NvbFR5cGU6ICdIVFRQJyB9KTtcclxuICAgIGNvbnN0IGFwaVN0YWdlID0gbmV3IGFwaWdhdGV3YXl2Mi5DZm5TdGFnZSh0aGlzLCAnTWFpbEFwaVN0YWdlJywgeyBzdGFnZU5hbWU6ICdwcm9kJywgYXBpSWQ6IGh0dHBBcGkucmVmLCBhdXRvRGVwbG95OiB0cnVlIH0pO1xyXG5cclxuICAgIGNvbnN0IGFwaURvbWFpbk5hbWUgPSBoYXNDdXN0b21Eb21haW4gPyBuZXcgYXBpZ2F0ZXdheXYyLkNmbkRvbWFpbk5hbWUodGhpcywgJ0FwaURvbWFpbk5hbWUnLCB7XHJcbiAgICAgIGRvbWFpbk5hbWU6IGFwaURvbWFpbiwgZG9tYWluTmFtZUNvbmZpZ3VyYXRpb25zOiBbeyBjZXJ0aWZpY2F0ZUFybjogY2VydEFybiEsIGVuZHBvaW50VHlwZTogJ1JFR0lPTkFMJywgc2VjdXJpdHlQb2xpY3k6ICdUTFNfMV8yJyB9XSxcclxuICAgIH0pIDogdW5kZWZpbmVkO1xyXG5cclxuICAgIGNvbnN0IGFwaU1hcHBpbmcgPSBoYXNDdXN0b21Eb21haW4gJiYgYXBpRG9tYWluTmFtZSA/IG5ldyBhcGlnYXRld2F5djIuQ2ZuQXBpTWFwcGluZyh0aGlzLCAnQXBpTWFwcGluZycsIHtcclxuICAgICAgYXBpSWQ6IGh0dHBBcGkucmVmLCBkb21haW5OYW1lOiBhcGlEb21haW5OYW1lLnJlZiwgc3RhZ2U6IGFwaVN0YWdlLnJlZiwgYXBpTWFwcGluZ0tleTogJ2V4YW1wbGVzJyxcclxuICAgIH0pIDogdW5kZWZpbmVkO1xyXG4gICAgaWYgKGFwaU1hcHBpbmcgJiYgYXBpRG9tYWluTmFtZSkgeyBhcGlNYXBwaW5nLmFkZERlcGVuZGVuY3koYXBpRG9tYWluTmFtZSk7IGFwaU1hcHBpbmcuYWRkRGVwZW5kZW5jeShhcGlTdGFnZSk7IH1cclxuXHJcbiAgICBjb25zdCBhcGlSZWNvcmQgPSBoYXNDdXN0b21Eb21haW4gJiYgaGFzSG9zdGVkWm9uZSAmJiBhcGlEb21haW5OYW1lID8gbmV3IHJvdXRlNTMuQ2ZuUmVjb3JkU2V0KHRoaXMsICdBcGlEb21haW5SZWNvcmQnLCB7XHJcbiAgICAgIGhvc3RlZFpvbmVJZDogem9uZUlkLCBuYW1lOiBhcGlEb21haW4sIHR5cGU6ICdBJywgYWxpYXNUYXJnZXQ6IHsgZG5zTmFtZTogYXBpRG9tYWluTmFtZS5hdHRyUmVnaW9uYWxEb21haW5OYW1lLCBob3N0ZWRab25lSWQ6IGFwaURvbWFpbk5hbWUuYXR0clJlZ2lvbmFsSG9zdGVkWm9uZUlkIH0sXHJcbiAgICB9KSA6IHVuZGVmaW5lZDtcclxuICAgIGlmIChhcGlSZWNvcmQgJiYgYXBpRG9tYWluTmFtZSkgYXBpUmVjb3JkLmFkZERlcGVuZGVuY3koYXBpRG9tYWluTmFtZSk7XHJcblxyXG4gICAgY29uc3QgYmFzZVVybCA9IGhhc0N1c3RvbURvbWFpbiA/IGBodHRwczovLyR7YXBpRG9tYWlufS9leGFtcGxlcy9nbWFpbC12aWV3ZXJgIDogY2RrLkZuLmpvaW4oJycsIFtodHRwQXBpLmF0dHJBcGlFbmRwb2ludCwgJy8nLCBhcGlTdGFnZS5yZWYsICcvZ21haWwtdmlld2VyJ10pO1xyXG5cclxuICAgIC8vIENsb3VkIE1hcCBOYW1lc3BhY2UgKEwyKVxyXG4gICAgY29uc3QgbmFtZXNwYWNlID0gbmV3IHNlcnZpY2VkaXNjb3ZlcnkuUHJpdmF0ZURuc05hbWVzcGFjZSh0aGlzLCAnU2VydmljZU5hbWVzcGFjZScsIHsgbmFtZTogbnNOYW1lLCB2cGMsIGRlc2NyaXB0aW9uOiAnTmFtZXNwYWNlIGZvciBtYWlsIHNlcnZpY2VzJyB9KTtcclxuXHJcbiAgICAvLyBWUEMgTGluayAoTDEpXHJcbiAgICBjb25zdCB2cGNMaW5rID0gbmV3IGFwaWdhdGV3YXl2Mi5DZm5WcGNMaW5rKHRoaXMsICdBcGlWcGNMaW5rJywgeyBuYW1lOiAnbWFpbC1leGFtcGxlLXZwY2xpbmsnLCBzdWJuZXRJZHM6IHNlcnZpY2VTdWJuZXRJZHMsIHNlY3VyaXR5R3JvdXBJZHM6IFthcGlWcGNMaW5rU2cuc2VjdXJpdHlHcm91cElkXSB9KTtcclxuXHJcbiAgICAvLyBDbG91ZCBNYXAgU2VydmljZSAoTDIpXHJcbiAgICBjb25zdCBjbG91ZE1hcFNlcnZpY2UgPSBuZXcgc2VydmljZWRpc2NvdmVyeS5TZXJ2aWNlKHRoaXMsICdBcHBDbG91ZE1hcFNlcnZpY2UnLCB7XHJcbiAgICAgIG5hbWU6ICdtYWlsLWV4YW1wbGUnLCBuYW1lc3BhY2UsIGRuc1JlY29yZFR5cGU6IHNlcnZpY2VkaXNjb3ZlcnkuRG5zUmVjb3JkVHlwZS5TUlYsIGRuc1R0bDogbnNUdGwsIHJvdXRpbmdQb2xpY3k6IHNlcnZpY2VkaXNjb3ZlcnkuUm91dGluZ1BvbGljeS5XRUlHSFRFRCwgY3VzdG9tSGVhbHRoQ2hlY2s6IHsgZmFpbHVyZVRocmVzaG9sZDogMSB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gU2VjcmV0cyBNYW5hZ2VyIC0gYWxsIGNvbmZpZyB2YWx1ZXMgZm9yIHRoZSBhcHBsaWNhdGlvblxyXG4gICAgY29uc3QgYXBwU2VjcmV0cyA9IG5ldyBzZWNyZXRzbWFuYWdlci5TZWNyZXQodGhpcywgJ0FwcFNlY3JldHMnLCB7XHJcbiAgICAgIHNlY3JldE5hbWU6IGAke3NzbVByZWZpeH0vY29uZmlnYCxcclxuICAgICAgZGVzY3JpcHRpb246ICdBcHBsaWNhdGlvbiBjb25maWd1cmF0aW9uIGZvciBtYWlsLWV4YW1wbGUnLFxyXG4gICAgICBzZWNyZXRPYmplY3RWYWx1ZToge1xyXG4gICAgICAgIEdPT0dMRV9DTElFTlRfSUQ6IGNkay5TZWNyZXRWYWx1ZS51bnNhZmVQbGFpblRleHQoZ29vZ2xlQ2xpZW50SWQpLFxyXG4gICAgICAgIEdPT0dMRV9DTElFTlRfU0VDUkVUOiBjZGsuU2VjcmV0VmFsdWUudW5zYWZlUGxhaW5UZXh0KGdvb2dsZUNsaWVudFNlY3JldCksXHJcbiAgICAgICAgU0VTU0lPTl9TRUNSRVQ6IGNkay5TZWNyZXRWYWx1ZS51bnNhZmVQbGFpblRleHQoc2Vzc2lvblNlY3JldFZhbHVlKSxcclxuICAgICAgICBCQVNFX1VSTDogY2RrLlNlY3JldFZhbHVlLnVuc2FmZVBsYWluVGV4dChiYXNlVXJsLnRvU3RyaW5nKCkpLFxyXG4gICAgICAgIFBPUlQ6IGNkay5TZWNyZXRWYWx1ZS51bnNhZmVQbGFpblRleHQoY29udGFpbmVyUG9ydC50b1N0cmluZygpKSxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIElBTSBSb2xlcyAoTDIpXHJcbiAgICBjb25zdCB0YXNrRXhlY1JvbGUgPSBuZXcgaWFtLlJvbGUodGhpcywgJ1Rhc2tFeGVjdXRpb25Sb2xlJywgeyBhc3N1bWVkQnk6IG5ldyBpYW0uU2VydmljZVByaW5jaXBhbCgnZWNzLXRhc2tzLmFtYXpvbmF3cy5jb20nKSwgbWFuYWdlZFBvbGljaWVzOiBbaWFtLk1hbmFnZWRQb2xpY3kuZnJvbUF3c01hbmFnZWRQb2xpY3lOYW1lKCdzZXJ2aWNlLXJvbGUvQW1hem9uRUNTVGFza0V4ZWN1dGlvblJvbGVQb2xpY3knKV0gfSk7XHJcbiAgICB0YXNrRXhlY1JvbGUuYWRkVG9Qb2xpY3kobmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoeyBhY3Rpb25zOiBbJ3NzbTpHZXRQYXJhbWV0ZXInLCAnc3NtOkdldFBhcmFtZXRlcnMnLCAnc3NtOkdldFBhcmFtZXRlcnNCeVBhdGgnLCAna21zOkRlY3J5cHQnXSwgcmVzb3VyY2VzOiBbYGFybjphd3M6c3NtOiR7dGhpcy5yZWdpb259OiR7dGhpcy5hY2NvdW50fTpwYXJhbWV0ZXIke3NzbVByZWZpeH0qYCwgYGFybjphd3M6a21zOiR7dGhpcy5yZWdpb259OiR7dGhpcy5hY2NvdW50fTprZXkvKmBdIH0pKTtcclxuICAgIHRhc2tFeGVjUm9sZS5hZGRUb1BvbGljeShuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7IGFjdGlvbnM6IFsnc2VjcmV0c21hbmFnZXI6R2V0U2VjcmV0VmFsdWUnXSwgcmVzb3VyY2VzOiBbYXBwU2VjcmV0cy5zZWNyZXRBcm5dIH0pKTtcclxuXHJcbiAgICBjb25zdCB0YXNrUm9sZSA9IG5ldyBpYW0uUm9sZSh0aGlzLCAnVGFza1JvbGUnLCB7IGFzc3VtZWRCeTogbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdlY3MtdGFza3MuYW1hem9uYXdzLmNvbScpIH0pO1xyXG4gICAgdGFza1JvbGUuYWRkVG9Qb2xpY3kobmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoeyBhY3Rpb25zOiBbJ3NzbTpHZXRQYXJhbWV0ZXInLCAnc3NtOkdldFBhcmFtZXRlcnMnLCAnc3NtOkdldFBhcmFtZXRlcnNCeVBhdGgnLCAna21zOkRlY3J5cHQnXSwgcmVzb3VyY2VzOiBbYGFybjphd3M6c3NtOiR7dGhpcy5yZWdpb259OiR7dGhpcy5hY2NvdW50fTpwYXJhbWV0ZXIke3NzbVByZWZpeH0qYCwgYGFybjphd3M6a21zOiR7dGhpcy5yZWdpb259OiR7dGhpcy5hY2NvdW50fTprZXkvKmBdIH0pKTtcclxuICAgIHRhc2tSb2xlLmFkZFRvUG9saWN5KG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHsgYWN0aW9uczogWydzZWNyZXRzbWFuYWdlcjpHZXRTZWNyZXRWYWx1ZSddLCByZXNvdXJjZXM6IFthcHBTZWNyZXRzLnNlY3JldEFybl0gfSkpO1xyXG5cclxuICAgIC8vIEVDUyBUYXNrIERlZmluaXRpb24gKEwyKVxyXG4gICAgY29uc3QgdGFza0RlZiA9IG5ldyBlY3MuRmFyZ2F0ZVRhc2tEZWZpbml0aW9uKHRoaXMsICdBcHBUYXNrRGVmaW5pdGlvbicsIHsgZmFtaWx5OiAnbWFpbC1leGFtcGxlJywgY3B1OiBjb250YWluZXJDcHUsIG1lbW9yeUxpbWl0TWlCOiBjb250YWluZXJNZW1vcnksIGV4ZWN1dGlvblJvbGU6IHRhc2tFeGVjUm9sZSwgdGFza1JvbGUgfSk7XHJcbiAgICB0YXNrRGVmLmFkZENvbnRhaW5lcignbWFpbC1leGFtcGxlJywge1xyXG4gICAgICBpbWFnZTogZWNzLkNvbnRhaW5lckltYWdlLmZyb21FY3JSZXBvc2l0b3J5KGVjclJlcG8sICdsYXRlc3QnKSwgcG9ydE1hcHBpbmdzOiBbeyBjb250YWluZXJQb3J0IH1dLFxyXG4gICAgICBsb2dnaW5nOiBlY3MuTG9nRHJpdmVycy5hd3NMb2dzKHsgbG9nR3JvdXA6IGFwcExvZ0dyb3VwLCBzdHJlYW1QcmVmaXg6ICdtYWlsLWV4YW1wbGUnIH0pLFxyXG4gICAgICBlbnZpcm9ubWVudDogeyBDT05GSUdfU1NNX1BSRUZJWDogc3NtUHJlZml4LCBQT1JUOiBjb250YWluZXJQb3J0LnRvU3RyaW5nKCksIEJBU0VfVVJMOiBiYXNlVXJsLnRvU3RyaW5nKCksIE5PREVfRU5WOiBwdWJsaWNFbnZWYWx1ZSB9LFxyXG4gICAgICBzZWNyZXRzOiB7XHJcbiAgICAgICAgR09PR0xFX0NMSUVOVF9JRDogZWNzLlNlY3JldC5mcm9tU2VjcmV0c01hbmFnZXIoYXBwU2VjcmV0cywgJ0dPT0dMRV9DTElFTlRfSUQnKSxcclxuICAgICAgICBHT09HTEVfQ0xJRU5UX1NFQ1JFVDogZWNzLlNlY3JldC5mcm9tU2VjcmV0c01hbmFnZXIoYXBwU2VjcmV0cywgJ0dPT0dMRV9DTElFTlRfU0VDUkVUJyksXHJcbiAgICAgICAgU0VTU0lPTl9TRUNSRVQ6IGVjcy5TZWNyZXQuZnJvbVNlY3JldHNNYW5hZ2VyKGFwcFNlY3JldHMsICdTRVNTSU9OX1NFQ1JFVCcpLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gRUNTIFNlcnZpY2UgKEwyKSAtIGFzc29jaWF0ZSB3aXRoIHN0YW5kYWxvbmUgQ2xvdWQgTWFwIHNlcnZpY2UgZm9yIEFQSSBHYXRld2F5IGludGVncmF0aW9uXHJcbiAgICBjb25zdCBzZXJ2aWNlID0gbmV3IGVjcy5GYXJnYXRlU2VydmljZSh0aGlzLCAnQXBwU2VydmljZScsIHtcclxuICAgICAgc2VydmljZU5hbWU6ICdtYWlsLWV4YW1wbGUnLCBjbHVzdGVyLCB0YXNrRGVmaW5pdGlvbjogdGFza0RlZiwgZGVzaXJlZENvdW50LFxyXG4gICAgICBjYXBhY2l0eVByb3ZpZGVyU3RyYXRlZ2llczogW3sgY2FwYWNpdHlQcm92aWRlcjogJ0ZBUkdBVEVfU1BPVCcsIHdlaWdodDogNCB9LCB7IGNhcGFjaXR5UHJvdmlkZXI6ICdGQVJHQVRFJywgd2VpZ2h0OiAxIH1dLFxyXG4gICAgICB2cGNTdWJuZXRzOiB7IHN1Ym5ldHM6IHNlcnZpY2VTdWJuZXRJZHMubWFwKChpZCwgaSkgPT4gZWMyLlN1Ym5ldC5mcm9tU3VibmV0SWQodGhpcywgYFNlcnZpY2VTdWJuZXQke2l9YCwgaWQpKSB9LFxyXG4gICAgICBzZWN1cml0eUdyb3VwczogW3NlcnZpY2VTZ10sIGFzc2lnblB1YmxpY0lwOiB1c2VQdWJsaWNTdWJuZXRzID8/IGZhbHNlLCBtaW5IZWFsdGh5UGVyY2VudDogNTAsIG1heEhlYWx0aHlQZXJjZW50OiAyMDAsXHJcbiAgICB9KTtcclxuICAgIHNlcnZpY2UuYXNzb2NpYXRlQ2xvdWRNYXBTZXJ2aWNlKHsgc2VydmljZTogY2xvdWRNYXBTZXJ2aWNlLCBjb250YWluZXJQb3J0LCBjb250YWluZXI6IHRhc2tEZWYuZGVmYXVsdENvbnRhaW5lciEgfSk7XHJcblxyXG4gICAgLy8gQVBJIEdhdGV3YXkgSW50ZWdyYXRpb24gKEwxKVxyXG4gICAgY29uc3QgaW50ZWdyYXRpb24gPSBuZXcgYXBpZ2F0ZXdheXYyLkNmbkludGVncmF0aW9uKHRoaXMsICdNYWlsSW50ZWdyYXRpb24nLCB7IGFwaUlkOiBodHRwQXBpLnJlZiwgaW50ZWdyYXRpb25UeXBlOiAnSFRUUF9QUk9YWScsIGludGVncmF0aW9uTWV0aG9kOiAnQU5ZJywgaW50ZWdyYXRpb25Vcmk6IGNsb3VkTWFwU2VydmljZS5zZXJ2aWNlQXJuLCBjb25uZWN0aW9uVHlwZTogJ1ZQQ19MSU5LJywgY29ubmVjdGlvbklkOiB2cGNMaW5rLnJlZiwgcGF5bG9hZEZvcm1hdFZlcnNpb246ICcxLjAnIH0pO1xyXG4gICAgbmV3IGFwaWdhdGV3YXl2Mi5DZm5Sb3V0ZSh0aGlzLCAnR21haWxWaWV3ZXJSb3V0ZScsIHsgYXBpSWQ6IGh0dHBBcGkucmVmLCByb3V0ZUtleTogJ0FOWSAvZ21haWwtdmlld2VyJywgdGFyZ2V0OiBgaW50ZWdyYXRpb25zLyR7aW50ZWdyYXRpb24ucmVmfWAgfSk7XHJcbiAgICBuZXcgYXBpZ2F0ZXdheXYyLkNmblJvdXRlKHRoaXMsICdHbWFpbFZpZXdlclByb3h5Um91dGUnLCB7IGFwaUlkOiBodHRwQXBpLnJlZiwgcm91dGVLZXk6ICdBTlkgL2dtYWlsLXZpZXdlci97cHJveHkrfScsIHRhcmdldDogYGludGVncmF0aW9ucy8ke2ludGVncmF0aW9uLnJlZn1gIH0pO1xyXG5cclxuICAgIC8vIENvZGVCdWlsZCBSb2xlIChMMilcclxuICAgIGNvbnN0IGJ1aWxkUm9sZSA9IG5ldyBpYW0uUm9sZSh0aGlzLCAnQ29kZUJ1aWxkUm9sZScsIHsgYXNzdW1lZEJ5OiBuZXcgaWFtLlNlcnZpY2VQcmluY2lwYWwoJ2NvZGVidWlsZC5hbWF6b25hd3MuY29tJykgfSk7XHJcbiAgICBidWlsZFJvbGUuYWRkVG9Qb2xpY3kobmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoeyBhY3Rpb25zOiBbJ2xvZ3M6Q3JlYXRlTG9nR3JvdXAnLCAnbG9nczpDcmVhdGVMb2dTdHJlYW0nLCAnbG9nczpQdXRMb2dFdmVudHMnXSwgcmVzb3VyY2VzOiBbJyonXSB9KSk7XHJcbiAgICBidWlsZFJvbGUuYWRkVG9Qb2xpY3kobmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoeyBhY3Rpb25zOiBbJ2VjcjpHZXRBdXRob3JpemF0aW9uVG9rZW4nLCAnZWNyOkJhdGNoQ2hlY2tMYXllckF2YWlsYWJpbGl0eScsICdlY3I6Q29tcGxldGVMYXllclVwbG9hZCcsICdlY3I6QmF0Y2hHZXRJbWFnZScsICdlY3I6RGVzY3JpYmVSZXBvc2l0b3JpZXMnLCAnZWNyOkluaXRpYXRlTGF5ZXJVcGxvYWQnLCAnZWNyOlB1dEltYWdlJywgJ2VjcjpVcGxvYWRMYXllclBhcnQnXSwgcmVzb3VyY2VzOiBbJyonXSB9KSk7XHJcbiAgICBidWlsZFJvbGUuYWRkVG9Qb2xpY3kobmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoeyBhY3Rpb25zOiBbJ2VjczpVcGRhdGVTZXJ2aWNlJywgJ2VjczpEZXNjcmliZVNlcnZpY2VzJywgJ2VjczpEZXNjcmliZUNsdXN0ZXJzJ10sIHJlc291cmNlczogWycqJ10gfSkpO1xyXG4gICAgYnVpbGRSb2xlLmFkZFRvUG9saWN5KG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHsgYWN0aW9uczogWydzc206R2V0UGFyYW1ldGVyJywgJ3NzbTpHZXRQYXJhbWV0ZXJzJywgJ3NzbTpHZXRQYXJhbWV0ZXJzQnlQYXRoJ10sIHJlc291cmNlczogWycqJ10gfSkpO1xyXG4gICAgaWYgKHByb3BzLmNvZGVDb25uZWN0aW9uQXJuKSBidWlsZFJvbGUuYWRkVG9Qb2xpY3kobmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoeyBhY3Rpb25zOiBbJ2NvZGVjb25uZWN0aW9uczpHZXRDb25uZWN0aW9uJywgJ2NvZGVjb25uZWN0aW9uczpHZXRDb25uZWN0aW9uVG9rZW4nLCAnY29kZWNvbm5lY3Rpb25zOlVzZUNvbm5lY3Rpb24nXSwgcmVzb3VyY2VzOiBbcHJvcHMuY29kZUNvbm5lY3Rpb25Bcm5dIH0pKTtcclxuXHJcbiAgICAvLyBDb2RlQnVpbGQgUHJvamVjdCAoTDIpXHJcbiAgICBuZXcgY29kZWJ1aWxkLlByb2plY3QodGhpcywgJ0NvZGVCdWlsZFByb2plY3QnLCB7XHJcbiAgICAgIHByb2plY3ROYW1lOiAnbWFpbC1leGFtcGxlJywgcm9sZTogYnVpbGRSb2xlLFxyXG4gICAgICBlbnZpcm9ubWVudDogeyBidWlsZEltYWdlOiBjb2RlYnVpbGQuTGludXhCdWlsZEltYWdlLlNUQU5EQVJEXzdfMCwgY29tcHV0ZVR5cGU6IGNvZGVidWlsZC5Db21wdXRlVHlwZS5TTUFMTCwgcHJpdmlsZWdlZDogdHJ1ZSwgZW52aXJvbm1lbnRWYXJpYWJsZXM6IHsgRUNSX1VSSTogeyB2YWx1ZTogZWNyUmVwby5yZXBvc2l0b3J5VXJpIH0sIENMVVNURVJfTkFNRTogeyB2YWx1ZTogY2x1c3Rlci5jbHVzdGVyTmFtZSB9LCBTRVJWSUNFX05BTUU6IHsgdmFsdWU6ICdtYWlsLWV4YW1wbGUnIH0gfSB9LFxyXG4gICAgICBzb3VyY2U6IGNvZGVidWlsZC5Tb3VyY2UuZ2l0SHViKHsgb3duZXI6IGdpdEh1Yk93bmVyLCByZXBvOiBnaXRIdWJSZXBvLCBicmFuY2hPclJlZjogZ2l0SHViQnJhbmNoIH0pLFxyXG4gICAgICB0aW1lb3V0OiBjZGsuRHVyYXRpb24ubWludXRlcygzMCksIHF1ZXVlZFRpbWVvdXQ6IGNkay5EdXJhdGlvbi5taW51dGVzKDMwKSwgYmFkZ2U6IHRydWUsIGRlc2NyaXB0aW9uOiAnQnVpbGQgJiBkZXBsb3kgbWFpbC1leGFtcGxlIHRvIEVDUiB0aGVuIGZvcmNlIEVDUyBkZXBsb3knLFxyXG4gICAgICBidWlsZFNwZWM6IGNvZGVidWlsZC5CdWlsZFNwZWMuZnJvbU9iamVjdCh7XHJcbiAgICAgICAgdmVyc2lvbjogJzAuMicsXHJcbiAgICAgICAgcGhhc2VzOiB7XHJcbiAgICAgICAgICBwcmVfYnVpbGQ6IHsgY29tbWFuZHM6IFsnZWNobyBcIkxvZ2dpbmcgaW4gdG8gRUNSXCInLCAnYXdzIGVjciBnZXQtbG9naW4tcGFzc3dvcmQgLS1yZWdpb24gJEFXU19ERUZBVUxUX1JFR0lPTiB8IGRvY2tlciBsb2dpbiAtLXVzZXJuYW1lIEFXUyAtLXBhc3N3b3JkLXN0ZGluICRFQ1JfVVJJJywgJ0lNQUdFX1RBRz0ke0NPREVCVUlMRF9SRVNPTFZFRF9TT1VSQ0VfVkVSU0lPTjotbGF0ZXN0fSddIH0sXHJcbiAgICAgICAgICBidWlsZDogeyBjb21tYW5kczogWydjZCBleGFtcGxlcy9nbWFpbC12aWV3ZXInLCAnZG9ja2VyIGJ1aWxkIC10ICRFQ1JfVVJJOmxhdGVzdCAtdCAkRUNSX1VSSTokSU1BR0VfVEFHIC4nXSB9LFxyXG4gICAgICAgICAgcG9zdF9idWlsZDogeyBjb21tYW5kczogWydkb2NrZXIgcHVzaCAkRUNSX1VSSTpsYXRlc3QnLCAnZG9ja2VyIHB1c2ggJEVDUl9VUkk6JElNQUdFX1RBRycsICdhd3MgZWNzIHVwZGF0ZS1zZXJ2aWNlIC0tY2x1c3RlciAkQ0xVU1RFUl9OQU1FIC0tc2VydmljZSAkU0VSVklDRV9OQU1FIC0tZm9yY2UtbmV3LWRlcGxveW1lbnQnXSB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYXJ0aWZhY3RzOiB7IGZpbGVzOiBbXSB9LCBlbnY6IHsgc2hlbGw6ICdiYXNoJyB9LFxyXG4gICAgICB9KSxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIE91dHB1dHNcclxuICAgIHRoaXMuY2x1c3Rlck5hbWUgPSBjbHVzdGVyLmNsdXN0ZXJOYW1lO1xyXG4gICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ0NsdXN0ZXJOYW1lJywgeyB2YWx1ZTogdGhpcy5jbHVzdGVyTmFtZSB9KTtcclxuICAgIHRoaXMucmVwb3NpdG9yeVVyaSA9IGVjclJlcG8ucmVwb3NpdG9yeVVyaTtcclxuICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsICdSZXBvc2l0b3J5VXJpJywgeyB2YWx1ZTogdGhpcy5yZXBvc2l0b3J5VXJpIH0pO1xyXG4gICAgdGhpcy5hcGlJbnZva2VVcmwgPSBiYXNlVXJsLnRvU3RyaW5nKCk7XHJcbiAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnQXBpSW52b2tlVXJsJywgeyB2YWx1ZTogdGhpcy5hcGlJbnZva2VVcmwgfSk7XHJcbiAgICB0aGlzLmNsb3VkTWFwU2VydmljZUFybiA9IGNsb3VkTWFwU2VydmljZS5zZXJ2aWNlQXJuO1xyXG4gICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ0Nsb3VkTWFwU2VydmljZUFybicsIHsgdmFsdWU6IHRoaXMuY2xvdWRNYXBTZXJ2aWNlQXJuIH0pO1xyXG4gIH1cclxufVxyXG4iXX0=